<!DOCTYPE html>
<html>

  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Gostations Direction</title>
    <%= Gon::Base.render_data %>
    <style>
     
      html, body {
        height: 100%;
        margin: 50;
        padding: 50;
      }
      #map {
        height: 100%;
        width: 80%;
        margin: auto;
      }

      #directions-panel {
        margin-top: 10px;
        background-color: #FFEE77;
        padding: 10px;
      }
    </style>
  </head>

  <body>

    <div class="container">
      <div class="jumbotron">
        <h1><%= @trip.name %></h1>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Harum cum earum eveniet omnis nostrum corporis excepturi repellendus at, cupiditate ut.</p>
      </div>
      <div class="progress">
        <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 45%">
          <span class="sr-only">45% Complete</span>
        </div>
      </div>
      <table class="table table-hover">
        <% @trip_gostations.each do |t| %>
          <tr>
            <td>
              <% if t.status == true %>
                <!-- toggle status for testing -->
                <%= link_to 'Done', check_trip_gostation_path(t), method: :post, class: "btn btn-primary" %>
              <% else %>
                <%= link_to 'Submit', check_trip_gostation_path(t), method: :post, class: "btn btn-primary" %>
              <% end%>
             <%= t.gostation.LocName %>
            </td>
          </tr>
        <% end %>
       </table>
       <div class="map col-xs-12">
         <img src="..." alt="..." class="img-rounded">
         <h1>map here</h1>
       </div>
    </div>

    <div id="map"></div>

    <script>

      var map = null;
      var infoWindow = null;

      function showGostations(){
        for(var i=0; i<gon.gostations.length; i++){
          var position = {};
          position.lat = +gon.gostations[i].Latitude;
          position.lng = +gon.gostations[i].Longitude;
          var LocName = gon.gostations[i].LocName;
          addMarker({
            coords: position,
            iconImage: 'http://maps.google.com/mapfiles/ms/micons/yellow-dot.png',
            content: '<a href="https://www.google.com/maps/dir/Current+Location/'+LocName+'" target="_blank">'+LocName+'</a>'
          });
        }
      }

      function addMarker(props){
        var marker = new google.maps.Marker({
          position: props.coords,
          map: map,
          icon: props.iconImage
        });

        if(props.content){
          marker.addListener('click', function(){
            if(infoWindow==null){
              infoWindow = new google.maps.InfoWindow();
            }
            infoWindow.setContent(props.content);
            infoWindow.open(map, marker);
          });
        }
      }

      function initMap() {

        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 8,
          center: {lat: 23.96099, lng: 120.97186}
        });

        showGostations();
      }

    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDBlueY1pKWgE_uhgFbjH8_cO2CjJCERaA&callback=initMap">
    </script>

  </body>
</html>
