<!DOCTYPE html>
<html>

  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Gostations Direction</title>
    <%= Gon::Base.render_data %>
    <style>
     
      html, body {
        height: 80%;
        margin: 50;
        padding: 50;
      }
      #map {
        height: 100%;
        width: 90%;
        margin: auto;
      }

      #directions-panel {
        margin-top: 10px;
        background-color: #FFEE77;
        padding: 10px;
      }
    </style>
  </head>

  <body class="background">
    <div id="myModal" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content trip-button">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title"><%= @trip.name%></h4>
          </div>
          <div class="modal-body">
            <p><%= @trip.description %></p>
          </div>
        </div>
      </div>
    </div>
    <div id="myProgress"  onclick="move()">
      <div id="myBar"></div>
    </div>
    <div id="map"></div>
    <br/>
    <div class="form-group comment-group clearfix">  
      <%= form_for [@trip, @comment] do |f|%>
        <%= f.text_area :comment, class: "form-control" %>
          <%= f.file_field :image %>
          <input class="btn btn-default" type="submit" value="留言">
        </div>
      <% end%>
    </div>
    <br/>
    <div class="comment-group">
      <h5>推荐景點</h5>
      <br/>
      <div class="">
      <% @comments.each do |comment|%>
        <div class="comment border col-xs-12 col-sm-4 col-xs-4">
          <div class="media">
            <div class="media-left text-center">
              <%= link_to(image_tag(comment.user.avatar), user_path(comment.user), class: "media-object", style: "width:64px;height:64px;border-radius:50%")%>
              Level: <%= comment.user.level%>
            </div>
            <div class="media-body clearfix">
              <p class="media-heading"><%= comment.user.name %></p>
              <P class="pull-right"><%= time_ago_in_words(comment.created_at)%></P>
              <%= image_tag comment.image,style:"border-radius:10px;"%>
              <p><%= comment.comment %></p>
            </div>
          </div>
        </div>
      <%end%>
    </div>
    </div>

  

    <script type="text/javascript">
       var width = 20;
      function move(){
        var elem = document.getElementById("myBar");
            width+= 20; 
            elem.style.width = width + '%';
          }
    </script>
    <script>

      var map = null;
      var infoWindow = null;

      function showGostations(){
        for(var i=0; i<gon.gostations.length; i++){
          var position = {};
          position.lat = +gon.gostations[i].Latitude;
          position.lng = +gon.gostations[i].Longitude;
          var LocName = gon.gostations[i].LocName;
          addMarker({
            coords: position,
            iconImage: 'http://maps.google.com/mapfiles/ms/micons/yellow-dot.png',
            content: '<a href="https://www.google.com/maps/dir/Current+Location/'+LocName+'" target="_blank">'+LocName+'</a>'
          });
        }
      }

      function addMarker(props){
        var marker = new google.maps.Marker({
          position: props.coords,
          map: map,
          icon: props.iconImage
        });

        if(props.content){
          marker.addListener('click', function(){
            if(infoWindow==null){
              infoWindow = new google.maps.InfoWindow();
            }
            infoWindow.setContent(props.content);
            infoWindow.open(map, marker);
          });
        }
      }

      function initMap() {

        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 8,
          center: {lat: 23.96099, lng: 120.97186},
          styles: [
  {
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#f5f5f5"
      }
    ]
  },
  {
    "elementType": "labels.icon",
    "stylers": [
      {
        "visibility": "off"
      }
    ]
  },
  {
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#616161"
      }
    ]
  },
  {
    "elementType": "labels.text.stroke",
    "stylers": [
      {
        "color": "#f5f5f5"
      }
    ]
  },
  {
    "featureType": "administrative.land_parcel",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#bdbdbd"
      }
    ]
  },
  {
    "featureType": "poi",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#eeeeee"
      }
    ]
  },
  {
    "featureType": "poi",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#757575"
      }
    ]
  },
  {
    "featureType": "poi.park",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#e5e5e5"
      }
    ]
  },
  {
    "featureType": "poi.park",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#9e9e9e"
      }
    ]
  },
  {
    "featureType": "road",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#ffffff"
      }
    ]
  },
  {
    "featureType": "road.arterial",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#757575"
      }
    ]
  },
  {
    "featureType": "road.highway",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#dadada"
      }
    ]
  },
  {
    "featureType": "road.highway",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#616161"
      }
    ]
  },
  {
    "featureType": "road.local",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#9e9e9e"
      }
    ]
  },
  {
    "featureType": "transit.line",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#e5e5e5"
      }
    ]
  },
  {
    "featureType": "transit.station",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#eeeeee"
      }
    ]
  },
  {
    "featureType": "water",
    "elementType": "geometry",
    "stylers": [
      {
        "color": "#c9c9c9"
      }
    ]
  },
  {
    "featureType": "water",
    "elementType": "labels.text.fill",
    "stylers": [
      {
        "color": "#9e9e9e"
      }
    ]
  }
]
        });

        showGostations();
      }

    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDBlueY1pKWgE_uhgFbjH8_cO2CjJCERaA&callback=initMap">
    </script>

  </body>
</html>
